<!DOCTYPE html>
<html>
<head>
    <title>Simple YouTube Embedder</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
    <style>
        /* Dark Mode Theme */
        body {
            font-family: Helvetica, Arial, sans-serif;
            background-color: #121212;
            color: #e0e0e0;
            text-align: center;
            padding: 20px;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            background-color: #1e1e1e;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.4);
            border: 1px solid #333;
            margin-bottom: 20px;
        }

        h1 { color: #ff4d4d; }
        p { color: #a0a0a0; }
        
        input[type="text"] {
            width: 80%;
            padding: 12px;
            font-size: 16px;
            border: 1px solid #444;
            background-color: #2b2b2b;
            color: #e0e0e0;
            border-radius: 4px;
            margin-bottom: 10px;
        }

        button {
            padding: 12px 22px;
            font-size: 16px;
            cursor: pointer;
            background-color: #d10000;
            color: white;
            border: none;
            border-radius: 4px;
            margin-top: 10px;
        }

        .video-wrapper {
            position: relative;
            padding-bottom: 56.25%; /* 16:9 Aspect Ratio */
            height: 0;
            overflow: hidden;
            max-width: 100%;
            background: #000;
            margin-top: 20px;
            border-radius: 4px;
        }

        .video-wrapper iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }
        
        #historyContainer { text-align: left; }
        #historyContainer h2 { text-align: center; color: #ccc; }
        #historyList { list-style-type: none; padding: 0; }
        #historyList li {
            background-color: #2b2b2b;
            padding: 10px;
            border-bottom: 1px solid #444;
            cursor: pointer;
        }
        #historyList li:hover { background-color: #3c3c3c; }
        #historyList li:first-child { border-top-left-radius: 4px; border-top-right-radius: 4px; }
        #historyList li:last-child { border-bottom: none; border-bottom-left-radius: 4px; border-bottom-right-radius: 4px; }
        .clear-history-btn { background-color: #555; margin-top: 15px; }

    </style>
</head>
<body>

    <div class="container">
        <h1>YouTube Embedder</h1>
        <p>Paste a URL for a Video, Playlist, or Channel.</p>
        
        <input type="text" id="youtubeUrl" placeholder="Paste URL here...">
        <br>
        <input type="text" id="itemName" placeholder="Enter name for history...">
        <br>
        <button onclick="handleEmbedClick()">Embed</button>

        <div id="videoContainer"></div>
    </div>
    
    <div class="container" id="historyContainer">
         <h2>History</h2>
         <ul id="historyList"></ul>
         <button onclick="clearHistory()" class="clear-history-btn">Clear History</button>
    </div>

    <script>
        // --- Main Functions ---

        function handleEmbedClick() {
            var urlInput = document.getElementById('youtubeUrl').value;
            var itemData = parseUrl(urlInput); // This function is now smarter

            if (itemData) {
                var nameInput = document.getElementById('itemName').value;
                var name = (nameInput.trim() === '') ? urlInput : nameInput;

                renderEmbed(itemData);
                saveToHistory(itemData, name);
                renderHistory();
            } else {
                var videoContainer = document.getElementById('videoContainer');
                videoContainer.innerHTML = '<p style="color:red;">Could not find a valid Video, Playlist, or Channel ID in that URL.</p>';
            }
        }
        
        function renderEmbed(itemData) {
            var videoContainer = document.getElementById('videoContainer');
            var embedUrl = '';

            if (itemData.type === 'video') {
                embedUrl = 'https://www.youtube.com/embed/' + itemData.id;
            } else if (itemData.type === 'playlist') {
                // This single URL format works for both regular playlists and channel uploads
                embedUrl = 'https://www.youtube.com/embed/videoseries?list=' + itemData.id;
            }

            var embedHtml = '<div class="video-wrapper">' + 
                              '<iframe src="' + embedUrl + '" frameborder="0" allowfullscreen></iframe>' + 
                            '</div>';
            videoContainer.innerHTML = embedHtml;
        }

        // --- UPDATED PARSING FUNCTION ---
        function parseUrl(url) {
            var processedUrl = url;

            // First, handle Google redirect links
            if (url.indexOf("google.com/url?") !== -1) {
                var q_start = url.indexOf('q=');
                if (q_start !== -1) {
                    var q_end = url.indexOf('&', q_start);
                    if (q_end === -1) q_end = url.length;
                    processedUrl = decodeURIComponent(url.substring(q_start + 2, q_end));
                }
            }
            
            // Check for a Playlist URL
            if (processedUrl.indexOf("playlist?list=") !== -1) {
                var listId = processedUrl.split('list=')[1].split('&')[0];
                return { type: 'playlist', id: listId };
            }

            // Check for a Channel URL and convert its ID to an Uploads Playlist ID
            if (processedUrl.indexOf("/channel/UC") !== -1) {
                var channelId = processedUrl.split('/channel/')[1].split('/')[0];
                if (channelId.substring(0, 2) === "UC") {
                    var uploadsId = "UU" + channelId.substring(2);
                    return { type: 'playlist', id: uploadsId };
                }
            }

            // Check for a Video URL (the fallback)
            var videoRegex = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/;
            var match = processedUrl.match(videoRegex);
            if (match && match[2].length == 11) {
                return { type: 'video', id: match[2] };
            }

            return null; // Return null if no valid format is found
        }

        // --- History Functions (Updated to handle item object) ---

        function getHistory() {
            var history = localStorage.getItem('videoHistory');
            return history ? JSON.parse(history) : [];
        }

        function saveToHistory(itemData, name) {
            var history = getHistory();
            var isAlreadySaved = false;
            for (var i = 0; i < history.length; i++) {
                if (history[i].id === itemData.id) {
                    isAlreadySaved = true;
                    break;
                }
            }
            if (!isAlreadySaved) {
                history.unshift({ id: itemData.id, type: itemData.type, name: name }); // Store type as well
                if (history.length > 20) history.pop();
                localStorage.setItem('videoHistory', JSON.stringify(history));
            }
        }

        function renderHistory() {
            var history = getHistory();
            var historyList = document.getElementById('historyList');
            historyList.innerHTML = ''; 

            if (history.length === 0) {
                 historyList.innerHTML = '<p style="text-align:center; color:#777;">No items in history yet.</p>';
                 return;
            }

            for (var i = 0; i < history.length; i++) {
                var item = history[i];
                // JSON.stringify the item object to pass it into the onclick function
                var itemString = JSON.stringify(item).replace(/'/g, "&apos;"); // Handle quotes
                var listItemHtml = '<li onclick="embedFromHistory(' + itemString + ')">' + item.name + '</li>';
                historyList.innerHTML += listItemHtml;
            }
        }
        
        function embedFromHistory(itemData) {
            document.getElementById('itemName').value = itemData.name;
            
            // Reconstruct a plausible URL for display
            var displayUrl = '';
            if(itemData.type === 'video') {
                displayUrl = 'https://www.youtube.com/watch?v=' + itemData.id;
            } else if (itemData.type === 'playlist') {
                 displayUrl = 'https://www.youtube.com/playlist?list=' + itemData.id;
            }
            document.getElementById('youtubeUrl').value = displayUrl;
            
            renderEmbed(itemData);
            window.scrollTo(0, 0);
        }

        function clearHistory() {
            localStorage.removeItem('videoHistory');
            renderHistory();
        }

        // --- Initial Load ---
        renderHistory();
    </script>

</body>
</html>
