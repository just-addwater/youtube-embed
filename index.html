<!DOCTYPE html>
<html>
<head>
    <title>Simple YouTube Embedder</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable-yes">
    <style>
        /* Dark Mode Theme - Full Width */
        body {
            font-family: Helvetica, Arial, sans-serif; background-color: #121212;
            color: #e0e0e0; text-align: center; margin: 0; padding: 0;
        }
        .container {
            background-color: #1e1e1e; padding: 15px; border-bottom: 1px solid #333;
        }
        #historyContainer { border-bottom: none; }
        h1 { color: #ff4d4d; margin-top: 10px; }
        p { color: #a0a0a0; }
        input[type="text"] {
            width: 85%; padding: 12px; font-size: 16px; border: 1px solid #444;
            background-color: #2b2b2b; color: #e0e0e0; border-radius: 4px; margin-bottom: 10px;
        }
        button {
            padding: 12px 22px; font-size: 16px; cursor: pointer;
            color: white; border: none; border-radius: 4px; margin-top: 10px;
        }
        .embed-button { background-color: #d10000; } /* Red for the main embed button */
        
        /* Yahoo Purple */
        .search-button-yahoo { background-color: #600090; } 

        .video-wrapper {
            position: relative; padding-bottom: 56.25%; height: 0;
            overflow: hidden; max-width: 100%; background: #000; margin-top: 15px;
        }
        .video-wrapper iframe {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
        }
        #historyContainer { text-align: left; }
        #historyContainer h2 { text-align: center; color: #ccc; }
        #historyList { list-style-type: none; padding: 0; }
        #historyList li {
            background-color: #2b2b2b; padding: 12px; border-bottom: 1px solid #444; cursor: pointer;
        }
        #historyList li:hover { background-color: #3c3c3c; }
        #historyList li:last-child { border-bottom: none; }
        .clear-history-btn { background-color: #555; margin-top: 15px; }
    </style>
</head>
<body>

    <!-- UPDATED SEARCH SECTION WITH YAHOO -->
    <div class="container">
        <h1>Find Videos</h1>
        <p>Type your search below. The results will open in a new tab. Copy a link from there and paste it in the embedder.</p>
        <input type="text" id="searchQuery" placeholder="Search for YouTube videos...">
        <br>
        <button onclick="performYahooSearch()" class="search-button-yahoo">Search on Yahoo</button>
    </div>

    <div class="container">
        <h1>Embed Video</h1>
        <p>Paste a URL for a Video, Playlist, or Channel.</p>
        <input type="text" id="youtubeUrl" placeholder="Paste URL here...">
        <br>
        <input type="text" id="itemName" placeholder="Enter name for history...">
        <br>
        <button onclick="handleEmbedClick()" class="embed-button">Embed</button>
        <div id="videoContainer"></div>
    </div>
    
    <div class="container" id="historyContainer">
         <h2>History</h2>
         <ul id="historyList"></ul>
         <button onclick="clearHistory()" class="clear-history-btn">Clear History</button>
    </div>

    <script>
        // --- NEW YAHOO SEARCH FUNCTION ---
        function performYahooSearch() {
            var searchQuery = document.getElementById('searchQuery').value;
            if (searchQuery.trim() !== '') {
                // Yahoo Video Search URL format
                var searchUrl = 'https://video.search.yahoo.com/search?p=' + encodeURIComponent(searchQuery);
                window.open(searchUrl, '_blank');
            }
        }
        
        // --- REWRITTEN PARSEURL FUNCTION ---
        function parseUrl(url) {
            var processedUrl = url;

            // Check for Yahoo Video Search URLs
            if (url.indexOf("video.search.yahoo.com") !== -1 && url.indexOf("rurl=") !== -1) {
                var rurl_start = url.indexOf("rurl=") + 5;
                var rurl_end = url.indexOf('&', rurl_start);
                if (rurl_end === -1) rurl_end = url.length;
                processedUrl = decodeURIComponent(url.substring(rurl_start, rurl_end));
            } 
            // Check for Yahoo Redirect URLs
            else if (url.indexOf("r.search.yahoo.com") !== -1 && url.indexOf("/RU=") !== -1) {
                var ru_start = url.indexOf("/RU=") + 4;
                var ru_end = url.indexOf('/RK=', ru_start);
                if (ru_end === -1) ru_end = url.length;
                processedUrl = decodeURIComponent(url.substring(ru_start, ru_end));
            }
            // Check for Google Redirect URLs
            else if (url.indexOf("google.com/url?") !== -1) {
                var q_start = url.indexOf('q=');
                if (q_start !== -1) {
                    var q_end = url.indexOf('&', q_start);
                    if (q_end === -1) q_end = url.length;
                    processedUrl = decodeURIComponent(url.substring(q_start + 2, q_end));
                }
            }

            // --- The rest of the parsing logic uses the cleaned 'processedUrl' ---
            if (processedUrl.indexOf("playlist?list=") !== -1) {
                var listId = processedUrl.split('list=')[1].split('&')[0];
                return { type: 'playlist', id: listId };
            }
            if (processedUrl.indexOf("/channel/UC") !== -1) {
                var channelId = processedUrl.split('/channel/')[1].split('/')[0];
                if (channelId.substring(0, 2) === "UC") {
                    var uploadsId = "UU" + channelId.substring(2);
                    return { type: 'playlist', id: uploadsId };
                }
            }
            var videoRegex = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/;
            var match = processedUrl.match(videoRegex);
            if (match && match[2].length == 11) {
                return { type: 'video', id: match[2] };
            }
            return null;
        }

        // --- All other functions remain the same ---
        function handleEmbedClick() {
            var urlInput = document.getElementById('youtubeUrl').value;
            var itemData = parseUrl(urlInput);
            if (itemData) {
                var nameInput = document.getElementById('itemName').value;
                var name = (nameInput.trim() === '') ? urlInput : nameInput;
                renderEmbed(itemData);
                saveToHistory(itemData, name);
                renderHistory();
                document.getElementById('youtubeUrl').value = '';
                document.getElementById('itemName').value = '';
            } else {
                var videoContainer = document.getElementById('videoContainer');
                videoContainer.innerHTML = '<p style="color:red;">Could not find a valid ID. Note: Channel URLs with /@handle are not supported.</p>';
            }
        }
        function renderEmbed(itemData) {
            var videoContainer = document.getElementById('videoContainer');
            var embedUrl = '';
            if (itemData.type === 'video') {
                embedUrl = 'https://www.youtube.com/embed/' + itemData.id;
            } else if (itemData.type === 'playlist') {
                embedUrl = 'https://www.youtube.com/embed/videoseries?list=' + itemData.id;
            }
            var embedHtml = '<div class="video-wrapper">' + '<iframe src="' + embedUrl + '" frameborder="0" allowfullscreen></iframe>' + '</div>';
            videoContainer.innerHTML = embedHtml;
        }
        function getHistory() {
            var history = localStorage.getItem('videoHistory');
            return history ? JSON.parse(history) : [];
        }
        function saveToHistory(itemData, name) {
            var history = getHistory();
            var isAlreadySaved = false;
            for (var i = 0; i < history.length; i++) {
                if (history[i].id === itemData.id) { isAlreadySaved = true; break; }
            }
            if (!isAlreadySaved) {
                history.unshift({ id: itemData.id, type: itemData.type, name: name });
                if (history.length > 35) { 
                    history.pop();
                }
                localStorage.setItem('videoHistory', JSON.stringify(history));
            }
        }
        function renderHistory() {
            var history = getHistory();
            var historyList = document.getElementById('historyList');
            historyList.innerHTML = '';
            if (history.length === 0) {
                 historyList.innerHTML = '<li style="text-align:center; color:#777; cursor:default;">No items in history yet.</li>';
                 return;
            }
            for (var i = 0; i < history.length; i++) {
                var item = history[i];
                var li = document.createElement('li');
                li.innerHTML = item.name;
                li.onclick = (function(currentItem) {
                    return function() { embedFromHistory(currentItem); };
                })(item);
                historyList.appendChild(li);
            }
        }
        function embedFromHistory(itemData) {
            document.getElementById('itemName').value = itemData.name;
            var displayUrl = '';
            if(itemData.type === 'video') {
                displayUrl = 'https://www.youtube.com/watch?v=' + itemData.id;
            } else if (itemData.type === 'playlist') {
                 displayUrl = 'https://www.youtube.com/playlist?list=' + itemData.id;
            }
            document.getElementById('youtubeUrl').value = displayUrl;
            renderEmbed(itemData);
            window.scrollTo(0, 0);
        }
        function clearHistory() {
            localStorage.removeItem('videoHistory');
            renderHistory();
        }
        renderHistory();
    </script>
</body>
</html>
